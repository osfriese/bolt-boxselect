{#=== OPTIONS ========================================================================================================#}

{% set option = {
    class:     field.class|default(''),
    label:     field.label|default(''),
    multiple:  (field.multiple is defined and field.multiple),
    values:    field.values|default([]),
    info:      field.info|default('')
} %}

{#=== INIT ===========================================================================================================#}

{% if option.values is iterable %}
    {% set values = option.values %}
{% else %}
    {% set lookuptype = option.values|split('/')|first %}
    {% set lookupfield = option.values|split('/')|last %}
    {% if ',' in lookupfield %}
        {% set lookupfield = lookupfield|split(',') %}
    {% endif %}
    {% set sortingorder = field.sort|default(lookupfield|first) %}
    {% set querylimit = field.limit|default(50) %}
    {% set wherefilter = field.filter|default({}) %}
    {% setcontent lookups = lookuptype where wherefilter order sortingorder nohydrate limit querylimit %}
    {% set values = lookups|selectfield(lookupfield, option.multiple, field.keys|default('id')) %}
{% endif %}

{# get the current selection. Either a single value, or an array. #}
{% set selection = context.content.get(contentkey)|default(null) %}
{% if selection is not iterable %}
    {% set selection = [ selection ] %}
{% endif %}


{#=== FIELDSET =======================================================================================================#}

<fieldset class="boxselectfield">

    <label class="col-sm-3 control-label">{{ (option.info) ? macro.infopop(labelkey, option.info) : labelkey }}</label>
    <div class="col-sm-9" >
            {% for id, value in values %}
                {% set is_array = (value is iterable and (value | length) > 1) %}
                
                {% set attr_opt = {
                    value:     value,
                    checked:  (is_array ? value[0] : value) in selection[0],
                } %}

                <div class="nowrap">
                <input{{ macro.attr(attr_opt) }} id="{{ name }}_{{ loop.index }}" 
                        type="{% if field.multiple %}checkbox{% else %}radio{% endif %}" 
                        name="{{ name }}[]" />
                        
                <label for="{{ name }}_{{ loop.index }}" class="bslabel">{{value}}</label>
                </div>               
                
            {% endfor %}

    </div>

</fieldset>

